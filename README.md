# research_management
google apps script for research management

## 概要

中核申請資料作成用のプログラムを管理するリポジトリ

## 処理手順
### jRCT, UMIN情報のスクレイピング
- 臨床研究中核病院様式出力!jRCTandUMINNumbersシートに出力対象のjRCT番号、UMIN番号をセットする。
- nmc Publication!Baseシートに出力する論文情報をセットする。
- R studioを開き、research_management直下でプロジェクトを作成。
- init.R, main.Rの順に実行。
- 臨床研究中核病院様式出力!ctr_outputシートに取得したCTR情報が出力される。
### スクレイピングした情報の展開
- 処理対象は臨床研究中核病院様式出力!fromHTMLシートに存在しないCTR番号のレコードとなる。
- 臨床研究中核病院様式出力のスプレッドシートのメニューから「CTR情報取得」を実行する。
- 臨床研究中核病院様式出力!fromHTMLシートにスクレイピングした情報と研究管理システムの情報を結合、編集した結果を出力する。
### 別添出力用テキストの再作成
- 臨床研究中核病院様式出力!fromHTMLシートの対象疾患名などを手修正した場合に必要に応じて実行する。
- 臨床研究中核病院様式出力のスプレッドシートのメニューから「別添２テキスト再作成」を実行すると処理対象は臨床研究中核病院様式出力!fromHTMLシートのS～U列が再作成される。
- 臨床研究中核病院様式出力のスプレッドシートのメニューから「別添３テキスト再作成」を実行すると処理対象は臨床研究中核病院様式出力!fromHTMLシートのV列が再作成される。
### 様式出力
- 臨床研究中核病院様式出力のスプレッドシートのメニューから「様式第２、３、別添２，３作成」を実行すると様式２、３と関連する別添が作成される。
- 臨床研究中核病院様式出力のスプレッドシートのメニューから「様式第２、別添２作成」を実行すると様式２と関連する別添が作成される。
- 臨床研究中核病院様式出力のスプレッドシートのメニューから「様式第３、別添３作成」を実行すると様式３と関連する別添が作成される。
## 開発

```
yarn install --frozen-lockfile
# このコマンドでGoogle Apps Script にログインする
clasp login
# webpackしたソースをpush
yarn start
```

## テスト
- スプレッドシートの拡張機能 > Apps script > から`execTest`を実行する
- プロパティで指定したIDのスプレッドシートに結果が出力される

## 本番へのデプロイ

TODO: 何度も実行するなら自動化する

```
mv .clasp.json .clasp.json.dev
# 本番のID でclone
yarn push
mv .clasp.json.dev .clasp.json
```
